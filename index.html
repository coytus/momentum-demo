<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŠ¨é‡å®ˆæ’æ¼”ç¤º | ç‰©ç†å®éªŒå®¤</title>
    <style>
        :root {
            --bg-color: #f6f7f9;
            --card-bg: #ffffff;
            --primary-color: #ff2e4d; /* å°çº¢ä¹¦çº¢ */
            --blue-color: #4facfe;
            --text-main: #333333;
            --text-sub: #888888;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            --radius: 24px;
        }

        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        /* æ ‡é¢˜åŒºåŸŸ */
        header {
            text-align: center;
            margin-bottom: 24px;
        }
        
        h1 {
            font-size: 1.5rem;
            margin: 0 0 8px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        p.subtitle {
            color: var(--text-sub);
            font-size: 0.9rem;
            margin: 0;
        }

        /* ä¸»å®¹å™¨ */
        .container {
            width: 100%;
            max-width: 800px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* æ¼”ç¤ºç”»å¸ƒå¡ç‰‡ */
        .canvas-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        canvas {
            width: 100%;
            height: 300px;
            background: #f0f4f8;
            border-radius: 16px;
            border: 2px solid #eef2f5;
        }

        /* ç¢°æ’ç±»å‹é€‰æ‹© */
        .mode-selector {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 10px 0;
        }

        .radio-label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 0.95rem;
            color: var(--text-sub);
            transition: 0.3s;
        }

        .radio-label input {
            margin-right: 8px;
            accent-color: var(--primary-color);
            transform: scale(1.2);
        }

        .radio-label.active {
            color: var(--text-main);
            font-weight: 600;
        }

        /* æ§åˆ¶é¢æ¿åŒºåŸŸ */
        .controls-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 600px) {
            .controls-grid {
                grid-template-columns: 1fr;
            }
        }

        .control-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 24px;
            box-shadow: var(--shadow);
            border-top: 6px solid transparent;
        }

        .control-card.red { border-top-color: var(--primary-color); }
        .control-card.blue { border-top-color: var(--blue-color); }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 10px;
        }

        .control-group {
            margin-bottom: 16px;
        }

        .label-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9rem;
            color: var(--text-sub);
        }

        .value-tag {
            background: #f0f0f0;
            padding: 2px 8px;
            border-radius: 6px;
            font-weight: 600;
            color: var(--text-main);
            font-family: monospace;
        }

        /* ç¾åŒ–æ»‘å— */
        input[type=range] {
            width: 100%;
            -webkit-appearance: none;
            background: transparent;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #fff;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
            cursor: pointer;
            margin-top: -8px;
            border: 2px solid #ddd;
        }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #eee;
            border-radius: 2px;
        }

        .red input[type=range]::-webkit-slider-thumb { border-color: var(--primary-color); }
        .blue input[type=range]::-webkit-slider-thumb { border-color: var(--blue-color); }

        /* æŒ‰é’® */
        .action-btn {
            background: linear-gradient(135deg, var(--primary-color), #ff6b81);
            color: white;
            border: none;
            padding: 14px 40px;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 8px 20px rgba(255, 46, 77, 0.3);
            transition: transform 0.2s;
            margin: 20px auto;
            display: block;
            width: 80%;
        }

        .action-btn:active {
            transform: scale(0.96);
        }
    </style>
</head>
<body>

    <header>
        <h1>âš›ï¸ åŠ¨é‡å®ˆæ’å®šå¾‹æ¼”ç¤º</h1>
        <p class="subtitle">åœ¨æ²¡æœ‰å¤–åŠ›ä½œç”¨æ—¶ï¼Œç³»ç»Ÿçš„æ€»åŠ¨é‡ä¿æŒä¸å˜</p>
    </header>

    <div class="container">
        <div class="canvas-card">
            <canvas id="simCanvas"></canvas>
            <div class="mode-selector">
                <label class="radio-label active">
                    <input type="radio" name="collisionType" value="elastic" checked> 
                    ğŸ”µ å®Œå…¨å¼¹æ€§ç¢°æ’
                </label>
                <label class="radio-label">
                    <input type="radio" name="collisionType" value="inelastic"> 
                    âšª å®Œå…¨éå¼¹æ€§ç¢°æ’
                </label>
            </div>
        </div>

        <button class="action-btn" onclick="resetSimulation()">ğŸ”„ é‡ç½® / å¼€å§‹æ¼”ç¤º</button>

        <div class="controls-grid">
            <div class="control-card red">
                <div class="card-header">
                    <div class="dot" style="background: var(--primary-color)"></div>
                    ç‰©ä½“ A (çº¢è‰²)
                </div>
                
                <div class="control-group">
                    <div class="label-row">
                        <span>è´¨é‡ (kg)</span>
                        <span class="value-tag" id="val-m1">2.0</span>
                    </div>
                    <input type="range" id="m1" min="1" max="10" step="0.5" value="2">
                </div>

                <div class="control-group">
                    <div class="label-row">
                        <span>åˆé€Ÿåº¦ (m/s)</span>
                        <span class="value-tag" id="val-v1">5.0</span>
                    </div>
                    <input type="range" id="v1" min="-10" max="10" step="0.5" value="5">
                </div>
            </div>

            <div class="control-card blue">
                <div class="card-header">
                    <div class="dot" style="background: var(--blue-color)"></div>
                    ç‰©ä½“ B (è“è‰²)
                </div>
                
                <div class="control-group">
                    <div class="label-row">
                        <span>è´¨é‡ (kg)</span>
                        <span class="value-tag" id="val-m2">3.0</span>
                    </div>
                    <input type="range" id="m2" min="1" max="10" step="0.5" value="3">
                </div>

                <div class="control-group">
                    <div class="label-row">
                        <span>åˆé€Ÿåº¦ (m/s)</span>
                        <span class="value-tag" id="val-v2">-3.0</span>
                    </div>
                    <input type="range" id="v2" min="-10" max="10" step="0.5" value="-3">
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');
        
        // çŠ¶æ€å˜é‡
        let animationId;
        let balls = [];
        let collisionType = 'elastic'; // elastic æˆ– inelastic

        // é€‚é…é«˜åˆ†å±
        function resizeCanvas() {
            const container = canvas.parentElement;
            canvas.width = container.clientWidth * 2;
            canvas.height = 300 * 2; // å›ºå®šé«˜åº¦
            ctx.scale(2, 2);
            canvas.style.width = container.clientWidth + 'px';
            canvas.style.height = '300px';
        }
        window.addEventListener('resize', resizeCanvas);

        // å°çƒç±»
        class Ball {
            constructor(x, color, m, v) {
                this.x = x;
                this.y = 150; // å‚ç›´å±…ä¸­
                this.color = color;
                this.m = m;
                this.v = v;
                this.radius = 20 + (m * 2); // è´¨é‡è¶Šå¤§åŠå¾„è¶Šå¤§
            }

            draw() {
                // ç”»çƒä½“
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                ctx.fill();
                
                // å†…éƒ¨é«˜å…‰ (å¢åŠ ç«‹ä½“æ„Ÿ)
                ctx.beginPath();
                ctx.arc(this.x - this.radius/3, this.y - this.radius/3, this.radius/4, 0, Math.PI * 2);
                ctx.fillStyle = 'rgba(255,255,255,0.3)';
                ctx.fill();

                // ç”»æ–‡å­— (è´¨é‡)
                ctx.fillStyle = '#fff';
                ctx.font = 'bold 14px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(this.m + 'kg', this.x, this.y);

                // ç”»é€Ÿåº¦ç®­å¤´å’Œæ–‡å­—
                this.drawVector();
            }

            drawVector() {
                if (Math.abs(this.v) < 0.1) return;
                
                const arrowLen = this.v * 10;
                const startX = this.x;
                const startY = this.y - this.radius - 15;
                const endX = startX + arrowLen;

                ctx.beginPath();
                ctx.moveTo(startX, startY);
                ctx.lineTo(endX, startY);
                ctx.strokeStyle = '#555';
                ctx.lineWidth = 2;
                ctx.stroke();

                // ç®­å¤´å¤´éƒ¨
                ctx.beginPath();
                if (this.v > 0) {
                    ctx.moveTo(endX, startY);
                    ctx.lineTo(endX - 5, startY - 3);
                    ctx.lineTo(endX - 5, startY + 3);
                } else {
                    ctx.moveTo(endX, startY);
                    ctx.lineTo(endX + 5, startY - 3);
                    ctx.lineTo(endX + 5, startY + 3);
                }
                ctx.fillStyle = '#555';
                ctx.fill();

                // é€Ÿåº¦æ•°å€¼
                ctx.fillStyle = '#333';
                ctx.font = '12px Arial';
                ctx.fillText(this.v.toFixed(1) + ' m/s', startX + arrowLen/2, startY - 10);
            }

            update() {
                this.x += this.v;
                
                // è¾¹ç•Œåå¼¹ (ä¸ºäº†æ¼”ç¤ºæ–¹ä¾¿ï¼Œæ’å¢™åå¼¹ï¼Œä½†ä¿ç•™åŠ¨é‡)
                if (this.x - this.radius < 0) {
                    this.x = this.radius;
                    this.v = -this.v;
                }
                if (this.x + this.radius > canvas.width / 2) { // Canvas scale 2
                    this.x = (canvas.width / 2) - this.radius;
                    this.v = -this.v;
                }
            }
        }

        // ç‰©ç†é€»è¾‘ï¼šç¢°æ’æ£€æµ‹ä¸å¤„ç†
        function checkCollision(b1, b2) {
            const dist = Math.abs(b1.x - b2.x);
            const minDist = b1.radius + b2.radius;

            if (dist <= minDist) {
                // ç®€å•çš„é˜²é‡å å¤„ç†
                const overlap = minDist - dist;
                const moveX = overlap / 2;
                b1.x -= moveX; 
                b2.x += moveX;

                if (collisionType === 'elastic') {
                    // å®Œå…¨å¼¹æ€§ç¢°æ’å…¬å¼
                    const v1 = ((b1.m - b2.m) * b1.v + 2 * b2.m * b2.v) / (b1.m + b2.m);
                    const v2 = ((b2.m - b1.m) * b2.v + 2 * b1.m * b1.v) / (b1.m + b2.m);
                    b1.v = v1;
                    b2.v = v2;
                } else {
                    // å®Œå…¨éå¼¹æ€§ç¢°æ’å…¬å¼ (ç²˜åœ¨ä¸€èµ·)
                    const vCommon = (b1.m * b1.v + b2.m * b2.v) / (b1.m + b2.m);
                    b1.v = vCommon;
                    b2.v = vCommon;
                }
            }
        }

        // åŠ¨ç”»å¾ªç¯
        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ç»˜åˆ¶ä¸­çº¿
            ctx.beginPath();
            ctx.setLineDash([5, 5]);
            ctx.moveTo(canvas.width / 4, 20); // Scale factor issue handled by context scale? No, logic coords.
            // Adjust logic for HighDPI:
            // Logic width = canvas.width / 2
            const w = canvas.width / 2;
            const h = canvas.height / 2;
            
            ctx.moveTo(w / 2, 20);
            ctx.lineTo(w / 2, h - 20);
            ctx.strokeStyle = '#ddd';
            ctx.stroke();
            ctx.setLineDash([]);

            balls.forEach(b => {
                b.update();
                b.draw();
            });

            checkCollision(balls[0], balls[1]);

            animationId = requestAnimationFrame(animate);
        }

        // é‡ç½®/åˆå§‹åŒ–
        function resetSimulation() {
            cancelAnimationFrame(animationId);
            
            // è·å–è¾“å…¥å€¼
            const m1 = parseFloat(document.getElementById('m1').value);
            const v1 = parseFloat(document.getElementById('v1').value);
            const m2 = parseFloat(document.getElementById('m2').value);
            const v2 = parseFloat(document.getElementById('v2').value);

            // ç¢°æ’ç±»å‹
            const radios = document.getElementsByName('collisionType');
            radios.forEach(r => {
                if(r.checked) collisionType = r.value;
                // æ›´æ–°UIæ ·å¼
                r.parentElement.classList.toggle('active', r.checked);
            });

            // åˆå§‹åŒ–ä½ç½® (é€»è¾‘åæ ‡)
            const w = canvas.width / 2;
            balls = [
                new Ball(w * 0.25, '#ff2e4d', m1, v1), // A
                new Ball(w * 0.75, '#4facfe', m2, v2)  // B
            ];

            animate();
        }

        // UI äº‹ä»¶ç›‘å¬
        const inputs = ['m1', 'v1', 'm2', 'v2'];
        inputs.forEach(id => {
            const el = document.getElementById(id);
            const display = document.getElementById('val-' + id);
            el.addEventListener('input', (e) => {
                display.innerText = e.target.value;
                // å®æ—¶æ›´æ–°å½“å‰çŠ¶æ€è¿˜æ˜¯é‡ç½®ï¼Ÿé€šå¸¸é‡ç½®æ¯”è¾ƒåˆç†
                resetSimulation(); 
            });
        });

        document.querySelectorAll('input[name="collisionType"]').forEach(el => {
            el.addEventListener('change', resetSimulation);
        });

        // å¯åŠ¨
        resizeCanvas();
        resetSimulation();

    </script>
</body>
</html>